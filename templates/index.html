{% extends "layout.html" %}

{% block head %}{% endblock %}

{% block body %}
<!-- Welcome Header -->
<div class="container-fluid">
  <div class="row dashboard-header white-bg">
    <div class="col-md-3">
      <h2>Welcome</h2>
      <small>Your account information is below.</small>
    </div>
  </div>
</div>
<!-- Account Information -->
<div class="container-fluid account-info white-bg">
  <div class="row">
    <!-- Account Balances -->
    <div class="col-sm-4 col-md-4">
      <h5 class="text-center">Depository Account Balances</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th><strong>Account</strong></th>
            <th><strong>Balance</strong></th>
          </tr>
        </thead>
        <tbody>
          {% for account in accounts | selectattr("type", "equalto", "depository") %}
          <tr>
            <td>{{ account.name }}</td>
            <td>${{ account.balance }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Savings Progress Bar -->
    <div class="col-sm-4">
      <h5 class="text-center">Savings Progress</h5>
      <div class="progress active">
        <div class="progress-bar" role="progressbar"></div>
      </div>
      <p class="savings-prog"></p>
      <p class="savings-text">saved of your <span class="savings-goal"></span> goal!</p>
    </div>
    <div class="col-sm-4">
      <h5 class="text-center">Stock Performance</h5>
    </div>
  </div>
  <div class="row">
    <!-- Net Worth Summary -->
    <div class="col-sm-8">
      <h5 class="text-center">Net Worth Summary</h5>
        <div class="row" id="chart_row">
          <div class="col-sm-4" id="net_worth_text">
            <h4>NET WORTH:</h4>
          </div>
          <div class="col-sm-4">
            <div id="assets_chart"></div>
          </div>
          <div class="col-sm-4">
            <div id="liabilities_chart"></div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4" id="net_worth_amt">
            <h4 id="net_worth_val"></h4>
          </div>
          <div class="col-sm-4">
            <h7>TOTAL ASSETS: <a id="assets_total"></a></h7>
            <table class="table table-striped" id="asset_table">
              <thead>
                <tr>
                  <th><strong>Account</strong></th>
                  <th><strong>Balance</strong></th>
                </tr>
              </thead>
            </table> 
          </div>
          <div class="col-sm-4">
           <h7>TOTAL LIABILITIES: <a id="liabilities_total"></a></h7>
            <table class="table table-striped" id="liability_table">
              <thead>
                <tr>
                  <th><strong>Account</strong></th>
                  <th><strong>Balance</strong></th>
                </tr>
              </thead>
            </table> 
          </div>
        </div>
    </div>
    <div class="col-sm-4">
      <h5 class="text-center">Debt Breakdown</h5>
    </div>
  </div>
</div>
<!-- Dashboard Content -->
<div class="container dashboard-content">
  <div class="row">
    <div class="col-lg-12">
      <div class="row">
        <div class="col-lg-4">
          <div class="dashboard-col spending-breakdown">
            <div class="dashboard-col-title">
              <h6>New spending data!</h6>
              <i class="fas fa-search-dollar spending-icon"></i>
            </div>
            <div class="dashboard-col-content">
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="dashboard-col">
            <div class="dashboard-col-title">
              <h6>New spending data!</h6>
              <i class="fas fa-search-dollar spending-icon"></i>
            </div>
            <div class="dashboard-col-content">
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="dashboard-col spending">
            <div class="dashboard-col-title">
              <h6>New spending data!</h6>
              <i class="fas fa-search-dollar spending-icon"></i>
            </div>
            <div class="dashboard-col-content">
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  /* Savings progress bar functionality */
  var savingsGoal = 500;
  var savingsBalance = {{ accounts | safe }}.filter( e => e.subtype == "savings")[0].balance;
  var savingsProg = (savingsBalance / savingsGoal) * 100;

  $(".progress-bar").html('$' + savingsBalance);
  $(".savings-prog").html(savingsProg + '%');
  $(".savings-goal").html('$' + savingsGoal);

  // Animates the width of the savings progress bar. Is executed by adding the ".active" class 
  // to the ".progress" element
  var current_width = 1;
  var progress = setInterval(() => {
    var $bar = $('.progress-bar');

    if (current_width >= savingsProg) {
        clearInterval(progress);
        $('.progress').removeClass('active');
    } else {
        ++current_width;
        $bar.width(current_width + "%");
    }

  }, 10);
</script>
<!-- Google charts file --> 
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="{{url_for('static', filename='javascript/index.js')}}"></script>
<script type="text/javascript">
  accounts = net_worth_calc({{accounts|tojson}})
</script>

{% endblock %}